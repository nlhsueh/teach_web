{% extends "template.html" %}

{% block title %}{{ novel.title }}{% endblock %}

<!-- for vscode -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% block style %}

{% endblock %}


{% block content %}

<section class="section container">
    <div class="d-flex">
        <a class="w-100 overflow-hidden text-decoration-none d-flex align-items-center" href="/studio/work/">
            <svg class="flex-shrink-0" xmlns="http://www.w3.org/2000/svg" height="16" width="10" fill="currentColor"
                viewBox="0 0 320 512">
                <path
                    d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
            </svg>
            <div class="text-truncate">
                {{ novel.title }}
            </div>
        </a>

        <button type="button" class="btn btn-danger flex-shrink-0" data-bs-toggle="modal"
            data-bs-target="#volumn_modal">新增章節</button>
        <button type="button" class="btn btn-danger ms-3 flex-shrink-0" data-bs-toggle="modal"
            data-bs-target="#chapter_modal">新增文章</button>
    </div>

    <div id="volumn_modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/studio/volumn/{{ novel.id }}" method="post">
                    {% csrf_token %}

                    {% if form_messages %}
                    <div class="text-danger text-center m-3">{{ form_messages }}</div>
                    {% endif %}
                    
                    <div class="modal-header">
                        <h5 class="modal-title">新增章節</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input class="form-control shadow-none {% if form.title.errors.0 %}is-invalid{% endif %}" name="title"
                                placeholder="章節名稱" value="{% if form %}{{ form.title.value }}{% endif %}">
                            <label>章節名稱</label>
                            <div class="invalid-feedback">{{ form.title.errors.0 }}</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger" data-bs-dismiss="modal">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="chapter_modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/studio/chapter/{{ novel.id }}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    {% if form_messages %}
                    <div class="text-danger text-center m-3">{{ form_messages }}</div>
                    {% endif %}
                    
                    <div class="modal-header">
                        <h5 class="modal-title">新增文章</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input class="form-control shadow-none {% if form.title.errors.0 %}is-invalid{% endif %}" name="title"
                                placeholder="文章名稱">
                            <label>文章名稱</label>
                            <div class="invalid-feedback">{{ form.title.errors.0 }}</div>
                        </div>

                        <div class="form-floating mb-3">
                            <input class="form-control shadow-none {% if form.title.errors.0 %}is-invalid{% endif %}" name="content"
                                placeholder="文章內容" type="file" accept=".txt">
                            <label>文章內容</label>
                            <div class="invalid-feedback">{{ form.title.errors.0 }}</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger" data-bs-dismiss="modal">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <hr>



    {% for volumn in catalog %}
    <div>
        <div class="w-100 rounded-0 btn btn-secondary text-start">{{ volumn.volumn.title }}</div>
        {% for chapter in volumn.chapters %}
        <a class="w-100 rounded-0 btn text-start border-0 border-bottom text-decoration-none"
            href="/novel/{{ novel.id }}/{{ chapter.id }}">{{ chapter.title }}</a>
        {% endfor %}
    </div>
    {% endfor %}
</section>

{% endblock %}